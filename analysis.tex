\section{Analysis}

We now prove the security of PoEM.

\begin{definition}[Entropic Growth]
  The \emph{Entropic Growth} property of
  a \poem execution,
  parametrized by the growth interval $s \in \mathbb{N}$
  and the entropic growth velocity $\tau \in \mathbb{R}^+$,
  states that for
  all honest parties $P$ and all rounds $r_1 + s \leq r_2$,
  the chains $C_1, C_2$ of $P$ at rounds $r_1, r_2$ respectively
  satisfy $\work(C_2[{|C_1|}{:}]) \geq s \tau$.
\end{definition}

\begin{definition}[Existential Entropic Quality]
  The \emph{Existential Entropic Quality} property of
  a \poem execution, parametrized by the entropic \emph{quality chunk parameter} $\ell \in \mathbb{N}$,
  % and \emph{quality concentration parameter} $\mu \in \mathbb{R}^+$ (with $\ell \mu \geq 1$)
  states that for
  all honest parties $P$ and all rounds $r$,
  the chain $C$ of $P$ at round $r$
  has the property that
  for every $0 \leq \alpha < \work(C) - \ell$,
  there is at least one honestly generated block in the chain
  $[{\alpha}{:}{\alpha + \ell}] \lhd C$.
\end{definition}

\begin{definition}[Entropic Common Prefix]
  The \emph{Entropic Common Prefix} property of
  a \poem execution, parametrized by the \emph{common prefix parameter} $k \in \mathbb{N}$
  states that for
  all honest parties $P_1, P_2$
  and all rounds $r_1 \leq r_2$,
  the chains $C_1, C_2$ that $P_1, P_2$ adopt at rounds $r_1, r_2$ respectively
  satisfy $[{:}{-k}] \lhd C_1 \preceq C_2$.
\end{definition}

In the analysis we are going to assume honest majority.

\begin{definition}[Honest Majority Assumption]
  We say that an execution has \emph{honest majority} with \emph{honest advantage parameter}
  $0 < \delta \leq 1$, if the number $t$ of corrupted parties out of
  $n$ parties satisfies $t < (1 - \delta) (n - t)$.
\end{definition}

Consider an execution of the \poem protocol.

We define a random variable $A_{r, i, j}$ as follows.
If at round $r$, the $j$-th query of (honest or adversarial) party $P_i$ is a valid block $B$,
then $A_{r, i, j} = \work(H(B))$.
If no valid block is found, $A_{r, i, j} = 0$.
Observe that $A_{r, i, j}$ can be expressed in the form $A_{r, i, j} = C_{r, i, j} W_{r, i, j}$,
with independent boolean random variable $C_{r, i, j} \sim \Bern(T)$ indicating whether the query was successful
and real random variable $W_{r, i, j} \sim \Exp(\ln2)$ measuring the work of the block found.

We define $X_{r} = \max_{j=1}^q \max_{i = 1}^{n - t} A_{r, i, j}$.
If at round $r$ at least one honest party finds a valid block ($X_r > 0$),
we say that round $r$ is a \emph{successful round}.
We let $f = \Pr[X_r > 0] = 1 - (1 - T)^{q(n - t)} \geq q(n - t)T$.
Solving for $T$ we obtain
\begin{align*}
  f &= 1 - (1 - T)^{q(n - t)}\\
  1 - f &= (1 - T)^{q(n - t)}\\
  (1 - f)^{\frac{1}{q(n - t)}} &= 1 - T\\
  T &= 1 - (1 - f)^{\frac{1}{q(n - t)}}\,.
\end{align*}

Let $\overline{X}_r = \sum_{i = 1}^{n - t} \sum_{j = 1}^q A_{r,i,j}$ and
\[
  \underbar{X}_r = \begin{cases}
  0 \text{, if there are no $i, j$ with $A_{r,i,j} > 0$; otherwise,}\\
  A_{r,i,j} \text{, where $(i, j)$ are the minimum such $(i, j)$.}
\end{cases}\]
Observe that $\underbar{X}_r \leq X_r \leq \overline{X}_r$
and $\E[\underbar{X}_r] \leq \E[X_r] \leq \E[\overline{X}_r]$.
Furthermore, $\underbar{X}_r \sim \Bern(1 - (1 - T)^{q(n - t)}) \Exp(\ln 2)$.

We define a random variable $Y_r$ as follows.
If at round $r$ exactly one honest party obtains a valid block, then $Y_r = X_r$,
and we call $r$ a \emph{convergence opportunity}. Otherwise, $Y_r = 0$.

We define $Z_{r}$ as the sum of all intrinsic work generated by all adversarial
party queries during round $r$. Hence, $Z_{r} = \sum_{i = n - t + 1}^n \sum_{j = 1}^q A_{r, i, j}$.

Given a set of rounds $S$, we define
$X(S) = \sum_{r \in S} X_r$,
$\overline{X}(S) = \sum_{r \in S} \overline{X}_r$,
$\underbar{X}(S) = \sum_{r \in S} \underbar{X}_r$,
$Y(S) = \sum_{r \in S} Y_r$
and $Z(S) = \sum_{r \in S} Z_r$.
Observe $\underbar{X}(S) \leq X(S) \leq \overline{X}(S)$.

In our protocol parametrization, we are free to choose how quickly blocks are produced
by honest parties by adjusting the target $T$ parameter, but only some configurations
will yield the desired security results. We will set $T$ such that the following
conditions are satisfied.

\begin{definition}[Secure Configuration]
  Given an environment which affords $q (n - t)$ queries per round to
  the honest parties, the secure configuration $f$ of PoEM requires
  $f = \frac{\delta}{6}$. This is achieved by using the secure target
  value $T = 1 - (1 - \frac{\delta}{6})^{\frac{1}{q(n - t)}}$.
\end{definition}

We will prove the PoEM protocol is secure if the above configuration is
followed.

We calculate the following expectations:
\begin{align*}
  \E[W_{r, i, j}] = \frac{1}{\ln2}\,.\\
  \E[A_{r, i, j}] =\\
  \E[A_{r, i, j} | C_{r, i, j} = 0] \Pr[C_{r, i, j} = 0] +\\
  \E[A_{r, i, j} | C_{r, i, j} = 1] \Pr[C_{r, i, j} = 1] =\\
  % \E[W_{r, i, j}] * \Pr[C_{r, i, j} = 1]
  \frac{T}{\ln2}\,.\\
  \E[Z_r] = \frac{tqT}{\ln2} < \frac{t}{n - t}\frac{f}{1 - f}\frac{1}{\ln2} < \left(1 + \frac{\delta}{2}\right)\frac{t}{n - t} \cdot \frac{f}{\ln2} \stepcounter{equation}\tag{\theequation}\label{eq.ex-z-bound} \,.
  % \E[Z(S)] =
  % \E[\sum_{r \in S} Z_r] = \sum_{r \in S} \E[Z_r] = \sum_{r \in S} \sum_{i = 1}^{t}{ \sum_{j = 1}^{q}{ \E[Z_{r, i, j}] } } = tq|S| \E[A_{r, i, j}] =\\
  % \frac{tq|S| T}{\ln2}\,.
\end{align*}

For the inequalities concerning $\E[Z_r]$, we used the derivation in~\cite{backbone}.

The probability of a convergence opportunity is
\begin{align*}
  (n - t) (1 - (1 - T)^q) (1 - T)^{q(n - t - 1)} \geq \\
  q(n - t) T (1 - T)^{q(n - t) - 1} > \\
  q(n - t) T (1 - (q(n - t) - 1)T) > \\
  q(n - t) T (1 - q(n - t)T)\,.
\end{align*}
The first expression is the probability that exactly one honest party is successful;
the second that exactly one query is successful. The penultimate inequality is by
Bernoulli's inequality ($(1 + x)^r \geq 1 + rx$ for integer $r \geq 1$ and $x \geq -1$).
Observe that $Y_r \sim \Bern((n - t)(1 - T)^{(n - t - 1)q}(1 - (1 - T)^q)) \Exp(\ln 2)$.

Therefore,
\begin{align*}
  \E[Y_r] > \frac{q(n - t)T(1 - q(n - T)T)}{\ln2} \geq \frac{f(1 - f)}{\ln2} > \frac{(1 - \frac{\delta}{3})f}{\ln2} \stepcounter{equation}\tag{\theequation}\label{eq.ex-y-bound}\,.\\
  \E[\underbar{X}_r] = \frac{1 - (1 - T)^{(n - t)q}}{\ln2}\,.\\
  \E[\overline{X}_r] = \frac{(n - t)qT}{\ln2} < \frac{f}{1 - f}\frac{1}{\ln2} \stepcounter{equation}\tag{\theequation}\label{eq.ex-overline-x-bound}\,.
\end{align*}

For the inequality concerning $\E[Y_r]$, the derivation is analogous to~\cite{backbone}.

\begin{definition}[Causality]
  An execution is \emph{causal} if no block (directly or indirectly) extends
  one which is computed at a later or the same random oracle query.
\end{definition}

\begin{definition}[\poem Typical Execution]
  An execution of \poem is \emph{($\epsilon,\lambda$)-typical} (or just typical),
  for $\epsilon \in (0,1)$ and integer $\lambda > 4$, if for any set $S$ of at
  least $\lambda$ consecutive rounds, the following hold.
  \begin{itemize}
    \item
    \begin{minipage}{\linewidth}%
      \vspace{-\abovedisplayskip}%
      \begin{align}%
        (1 - \epsilon) \E[\underbar{X}(S)] < X(S) < (1 + \epsilon) \E[\overline{X}(S)] \label{eq.typical-x}%
      \end{align}%
    \end{minipage}

    \item
    \begin{minipage}{\linewidth}%
      \vspace{-\abovedisplayskip}%
      \begin{align}%
        (1 - \epsilon) \E[Y(S)] < Y(S) \label{eq.typical-y}%
      \end{align}%
    \end{minipage}

    \item
    \begin{minipage}{\linewidth}%
      \vspace{-\abovedisplayskip}%
      \begin{align}%
        Z(S) < (1 + \epsilon)\E[Z(S)] \label{eq.typical-z}%
      \end{align}%
    \end{minipage}

    \item It is causal.
    \item It has hash separation.
  \end{itemize}
\end{definition}

In our analysis, we will let $\epsilon = \frac{\delta}{6}$. If the desired
maximum probability of failure is made concrete, this $\epsilon$, together
with the concrete probabilities later calculated in Theorem~\ref{thm:typicality},
will determine the concrete value of $\lambda$, from which the rest of the
concrete protocol parameters follow. In particular, the value $k$
for the ledger stabilization rule is
determined by $\lambda$ and $f$, and $\lambda$ can be calculated from $\epsilon$,
whereas both $f$ and $\epsilon$ can be determined from the desired acceptable
honest advantage $\delta$.

We will now prove that typical executions occur with overwhelming probability.
Towards this purpose, we will need a couple of auxiliary lemmas.

In the following arguments, we connect the \emph{real valued}
random oracle, evaluated using the $\work(B) \in \mathbb{R}^+$
function (an ideal quantity
unobservable by any Turing Machine, as it cannot process real-valued
inputs), and its $\kappa$-bit \emph{discrete approximation} $\awork(B)$ (observable by
a Turing Machine by invoking $H(B)[{:}{\kappa}]$). We show that the
difference between these two quantities is immaterial for polynomially-bound
computations, namely they notably diverge only with negligible probability.
This connection between real-valued and discrete-valued
random variables will allow us to conduct our analysis using real-valued
random variables and, in particular, random variables distributed according to the
\emph{continuous} exponential distribution. These distributions lend themselves
to easier tools than conducting a cumbersome analysis in the discrete domain.
The following lemmas that translate between the continuous and discrete worlds
will allow us to later utilize our continuous results in the discrete
realization of the protocol.

First, we make a few observations about the relationship
between the real and the approximate work of blocks and chains.
Observe that for hash input $A$, we have
$\aH(A) \leq H(A)$ and for block $B$ we have
$\awork(B) \geq \work(B)$,
and for blocks $B_1, B_2$ we have
$\work(B_1) \geq \work(B_2) \rightarrow \awork(B_1) \geq \awork(B_2)$.
Additionally, because $T = T[{:}\kappa]$, for any block $B$ it holds
that $\aH(B) < T \leftrightarrow H(B) < T$.

Furthermore, taking approximate works preserves
the order of blocks in the following fashion.

\begin{lemma}\label{lemma:awork-rounding}
  For all $A, B \in (0, 1)$, it holds that
  $\work(A) \geq \work(B) \rightarrow \awork(A) \geq \awork(B)$.
\end{lemma}
\begin{proof}
  \begin{align*}
                &\work(A) \geq \work(B) \Rightarrow -\lg A \geq -\lg B \Rightarrow \lg A \leq \lg B\\
    \Rightarrow &A \leq B \Rightarrow 2^\kappa A \leq 2^\kappa B \Rightarrow \lfloor 2^\kappa A \rfloor \leq \lfloor 2^\kappa B \rfloor \Rightarrow \frac{\lfloor 2^\kappa A \rfloor}{2^\kappa} \leq \frac{\lfloor 2^\kappa B \rfloor}{2^\kappa}\\
    \Rightarrow &\lg \frac{\lfloor 2^\kappa A \rfloor}{2^\kappa} \leq \lg \frac{\lfloor 2^\kappa B \rfloor}{2^\kappa} \Rightarrow -\lg \frac{\lfloor 2^\kappa A \rfloor}{2^\kappa} \geq -\lg \frac{\lfloor 2^\kappa B \rfloor}{2^\kappa}\\
    \Rightarrow &\awork(A) \geq \awork(B)
  \end{align*}
  \Qed
\end{proof}

Showing that the order of \emph{chains}
is preserved under approximate work is a bit more involved,
and we will work towards it next.
Towards this, we observe that the approximate work of a block is
close to its real work.

\begin{lemma}[Block Work Approximation]\label{lem:block-work-approximation}
  In a PoEM execution, consider the event $\CLOSE$ that all blocks $B$
  have $\awork(B) - \work(B) < 2^{-\kappa/2}$.
  The probability $\Pr[\CLOSE]$ is overwhelming in $\kappa$.
\end{lemma}
\begin{proof}
  Consider the event $E$ in which for all blocks $B$ it holds that
  $H(B) > \frac{1}{2^{\kappa/2}}$.
  Let us calculate the probability of $\lnot E$. For $\lnot E$ to happen,
  at least one block must have $H(B) \leq \frac{1}{2^{\kappa/2}}$.
  For any block $B$, it holds that $\Pr[H(B) \leq \frac{1}{2^{\kappa/2}}] = \frac{1}{2^{\kappa/2}}$ (from the
  uniform distribution of $H(B)$ in the interval $(0, 1)$ due to it being a real-valued random oracle).
  Since there are at most $nqL$ blocks in the execution, by applying a union bound, we have
  $\Pr[\lnot E] = \Pr[\exists B: H(B) \leq \frac{1}{2^{\kappa/2}}] \leq \sum_B \Pr[H(B) \leq \frac{1}{2^{\kappa/2}}] \leq \frac{nqL}{2^{\kappa/2}}$,
  which is negligible in $\kappa$,
  so $E$ happens with overwhelming probability.

  Consider a block $B$ of the execution, conditioned on the event $E$.
  Then
  \begin{align*}
        &\awork(B) - \work(B) = -\lg \aH(B) - (-\lg H(B))\\
       <& -\lg\left(H(B) - \frac{1}{2^\kappa}\right) - (-\lg H(B))\\
    \leq& -\lg\left(\frac{1}{2^{\kappa/2}} - \frac{1}{2^\kappa}\right) - \left(-\lg{\frac{1}{2^{\kappa/2}}}\right)\\
       =& -\lg\frac{1 - 2^{-\kappa/2}}{2^{\kappa/2}} - \frac{\kappa}{2} \\
       =& -\lg{1 - 2^{-\kappa/2}} \leq -\ln{1 - 2^{-\kappa/2}} \leq 2^{-\kappa/2}\,.
  \end{align*}

  The first inequality stems from the fact that $\aH(B)$ and $H(B)$ must
  differ by less than $\frac{1}{2^\kappa}$. The second inequality stems from
  the fact that the function $-\lg\left(x - \frac{1}{2^\kappa}\right) - (-\lg x)$ is
  decreasing for $x > \frac{1}{2^\kappa}$.
  \Qed
\end{proof}

The approximate work of a chain is also close to the real work of a chain.

\begin{corollary}[Chain Work Approximation]\label{cor:chain-work-approximation}
  In a PoEM execution, the probability that all chains $C$
  have $\awork(C) - \work(C) < Lqn 2^{-\kappa/2}$
  is overwhelming in $\kappa$.
\end{corollary}
\begin{proof}
  Conditioned on the overwhelming event of Lemma~\ref{lem:block-work-approximation}, for all
  chains $C$ it holds that
  \begin{align*}
     &\awork(C) - \work(C) = \sum_{B \in C}{\awork(B) - \work(B)}\\
    <& \sum_{B \in C}{2^{-\kappa/2}} = |C| 2^{-\kappa/2} \leq Lqn 2^{-\kappa/2}\,.
  \end{align*}
  \Qed
\end{proof}

We are now ready to prove a technical lemma which shows that works
of chains do not fall dangerously close to each other.

\begin{lemma}\label{lem:good-ranges}
  Consider a PoEM execution $\mathcal{E}$ with $n$ parties, $q$ queries per round per party,
  and total lifetime $L$.
  Consider the $j$-th random oracle query in this execution.
  If the query is successful, let $B$ indicate its produced block, let
  $w = \work(B), \aw = \awork(B)$, and let $C$ be the
  chain it extends, let $w_1 = \work(C), \aw_1 = \awork(C)$, and
  $w_1' = \work(CB), \aw_1' = \awork(CB)$. Consider any other chain $C_i$ that appears in the
  execution, and let $w_2 = \work(C_i), \aw_2 = \awork(C_i)$.
  Let $\BADRANGE_{j,i}$ denote the event that both
  $w_1 < w_2$, and, furthermore, either
  $w_2 - \frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}} \leq w_1 + w < w_2$ or
  $w_2 < w_1 + w \leq w_2 + \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}}$.
  Let $\BADRANGE$ denote the event that there exists a random oracle query $j$
  and a chain $C_i$ in the execution such that $\BADRANGE_{j,i}$.
  The probability $\Pr[\BADRANGE]$ is negligible in $\kappa$.
\end{lemma}
\begin{proof}
  If the $j$-th query does takes place, its $w$ is distributed as $\Exp(\ln2)$,
  so for every other chain $C_i$ in the execution for which $w_1 < w_2$ we have
  \begin{align*}
    \Pr[w_2 - \frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}} \leq w_1 + w < w_2 | w_1 < w_2] = \\
    \Pr[w_2 - w_1 - \frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}} \leq w < w_2 - w_1 | w_1 < w_2] = \\
    (1 - 2^{-(w_2 - w_1)}) - (1 - 2^{-\left(w_2 - w_1 - \frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}}\right)}) = \\
    2^{-\left(w_2 - w_1 - \frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}}\right)} - 2^{-(w_2 - w_1)} = \\
    2^{-(w_2 - w_1)} (2^{\frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}}} - 1) \leq
    2^{\frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}}} - 1 <
    \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}}\,.
  \end{align*}

  The second relation is from the cumulative distribution function of the exponential distribution;
  the fifth relation is from the conditioning on $w_1 < w_2$, and the last relation is from
  Lemma~\ref{lem:bernoulli}, noting that $0 < \frac{nqL + 1}{2^{\kappa/2}} < 1$.

  Similarly for the other direction,
  \begin{align*}
    \Pr[w_2 < w_1 + w \leq w_2 + \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}} | w_1 < w_2] = \\
    \Pr[w_2 - w_1 < w \leq w_2 - w_1 + \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}} | w_1 < w_2] = \\
    (1 - 2^{-\left(w_2 - w_1 + \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}}\right)}) - (1 - 2^{-(w_2 - w_1)}) = \\
    2^{-(w_2 - w_1)} - 2^{-\left(w_2 - w_1 + \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}}\right)} = \\
    2^{-(w_2 - w_1)} (1 - 2^{-\frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}}}) \leq
    1 - 2^{-\frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}}} <
    \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}}\,.
  \end{align*}

  Consequently,
  \begin{align*}
      &\Pr[\BADRANGE_{j,i}]
    = \Pr[\BADRANGE_{j,i}|w_1 < w_2]\Pr[w_1 < w_2]\\
    \leq & \Pr[\BADRANGE_{j,i}|w_1 < w_2]\\
    = &\Pr[w_2 - \frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}} \leq w_1 + w < w_2 | w_1 < w_2] +\\
      &\Pr[w_2 < w_1 + w \leq w_2 + \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}} | w_1 < w_2]\\
    = &2 \frac{nqL + 1}{2^{\kappa/2}}\\
  \end{align*}

  Applying a union bound over all the queries $j$ and chains $i$ of the execution, we obtain
  $\Pr[\BADRANGE] \leq 2 (nqL)^2 \cdot \frac{nqL + 1}{2^{\kappa/2}}$, which is negligible in $\kappa$.
  \Qed
\end{proof}

\begin{lemma}[Hash Separation]\label{lem:hash-separation}
  Consider a causal execution of PoEM. Let $\HS$ be the event that for
  all two (adversarial or honest) chains
  $C_1, C_2$ appearing in the execution, if
  $\work(C_1) < \work(C_2)$, then $\awork(C_1) < \awork(C_2)$.
  The probability that $\lnot \HS$ is negligible in $\kappa$.
\end{lemma}
\begin{proof}
  % There are at most $Lqn$ random oracle queries in the execution.
  Consider a causal execution of PoEM for which
  the event $\CLOSE$ of Lemma~\ref{lem:block-work-approximation}
  and the event $\lnot \BADRANGE$ of Lemma~\ref{lem:good-ranges}
  both hold.
  Observe that the statement of Corollary~\ref{cor:chain-work-approximation}
  holds in this conditioning.
  From the two lemmas we know that $\Pr[\CLOSE]$ and
  $\Pr[\lnot \BADRANGE]$ are both overwhelming, therefore
  $\Pr[\CLOSE \land \lnot \BADRANGE]$ is overwhelming.
  Conditioned on this event, we will
  show that the desired statement holds with probability $1$.

  Let $\HS_j$ denote the predicate that $\HS$ holds for all chains appearing
  before, or at, the $j$-th random oracle query, with $j = 0$ indicating
  the beginning of the execution.
  We will use induction on $j$ to show that for all $0 \leq j \leq Lnq$,
  $\HS_j$ holds. We know that $\HS_0$ always holds by definition.

  Now, consider the $j$-th random oracle query and suppose $\HS_{j - 1}$ holds.
  If the query was unsuccessful, then $\HS_j$ holds and we are done.
  Otherwise, let $C_1$ be the chain
  that the $j$-th random oracle query extends, let $B$ be the block mined on it,
  let $C'_1 = C_1 B$, and let $w = \work(B), w_1 = \work(C_1), w'_1 = \work(C'_1)$
  and $\aw, \aw_1, \aw'_1$ be the respective approximate works.
  Consider any other chain $C_2$ with work $w_2 = \work(C_2)$
  and approximate work $\aw_2$
  that has already appeared in the execution,
  and consider the undesirable event $\FLIP_{C_1,C_2}$ that
  $w'_1 < w_2 \land \aw'_1 \geq \aw_2$ or $w'_1 > w_2 \land \aw'_1 \leq \aw_2$.
  If $w_1 \geq w_2$, then, because $w > 0$, therefore $w_1 + w > w_2$ and hence $w_1' > w_2$.
  Additionally, by $\HS_{j - 1}$ we have $\aw_1 > \aw_2$, therefore $\aw_1 + \aw > \aw_2$, and
  $\aw_1' > \aw_2$. From this, it follows that $w_1 \geq w_2$ yields $\lnot \FLIP_{C_1,C_2}$.
  Thus, it suffices to only consider the situation where $w_1 < w_2$.

  We distinguish two cases:

  \noindent
  \textbf{Case 1: } $w_1 + w < w_2$.
  From the conditioning on $\lnot \BADRANGE$, we have
  $w_1 + w < w_2 - \frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}}$,
  therefore
  \begin{align*}
    \aw_1 - \frac{nqL}{2^{\kappa/2}} + w &< w_2 - \frac{nqL}{2^{\kappa/2}} - \frac{1}{2^{\kappa/2}}\\
    \aw_1 + w &< w_2 - \frac{1}{2^{\kappa/2}}\\
    \aw_1 + \aw - \frac{1}{2^{\kappa/2}} &< w_2 - \frac{1}{2^{\kappa/2}}\\
    \aw_1 + \aw &< w_2 \\
    \aw'_1 &< w_2 \leq \aw_2\,.
  \end{align*}
  The first inequality is obtained from the conditioning on $\CLOSE$,
  noting that $\aw_1 - \frac{nqL}{2^{\kappa/2}} < w_1$ follows from
  $\aw_1 - w_1 < Lqn 2^{-\kappa/2}$ (Corollary~\ref{cor:chain-work-approximation}).
  The third inequality is also obtained from the conditioning on $\CLOSE$,
  noting that $\aw - \frac{1}{2^{\kappa/2}} < w$ follows from
  $\aw - w < 2^{-\kappa/2}$ (Lemma~\ref{lem:block-work-approximation}).
  It follows that $\lnot \FLIP_{C_1,C_2}$.

  \noindent
  \textbf{Case 2: } $w_1 + w > w_2$.
  From the conditioning on $\lnot \BADRANGE$, we have
  $w_1 + w > w_2 + \frac{nqL}{2^{\kappa/2}} + \frac{1}{2^{\kappa/2}} > w_2 + \frac{nqL}{2^{\kappa/2}}$,
  therefore
  \begin{align*}
    w_1 + w &> \aw_2 - \frac{nqL}{2^{\kappa/2}} + \frac{nqL}{2^{\kappa/2}}\\
    w_1 + w &> \aw_2\\
    \aw_1 + \aw &> \aw_2 \\
    \aw'_1 &> \aw_2\,.
  \end{align*}
  Again, it follows that $\lnot \FLIP_{C_1,C_2}$.

  From this and $\HS_{j-1}$ it follows that $\HS_j$ holds.
  Therefore, by induction, $\HS_{Lnq}$ holds, and hence $\HS$ holds.
  Since our conditioning was on an overwhelming event, the lemma follows.
  \Qed
\end{proof}

\dznote{Handle the case of equality}

\begin{corollary}[Approximate Fork Choice]
  In Hash Separated executions of PoEM, for any two chains $C_1, C_2$
  it holds that $\awork(C_1) < \awork(C_2) \rightarrow \work(C_1) < \work(C_2)$.
\end{corollary}
\begin{proof}
  Towards a contradiction, suppose that $\awork(C_1) < \awork(C_2)$, but
  $\work(C_1) \geq \work(C_2)$. From Hash Separation, it follows that
  $\awork(C_1) \geq \awork(C_2)$, which is a contradiction.
  \Qed
\end{proof}

% \begin{lemma}
%   $f(\kappa) = 2^{\frac{nqL + 1}{2^{\kappa/2}}} - 1$ is negligible.
% \end{lemma}
% \begin{proof}
%   It suffices to show that $f(\kappa) < \frac{nqL + 1}{2^{\kappa/2}}$
%   for sufficiently large $\kappa$, since $\frac{nqL + 1}{2^{\kappa/2}}$
%   is negligible.
%   This follows by applying Lemma~\ref{lem:bernoulli} for $y = \frac{nqL + 1}{2^{\kappa/2}}$.
%   Note that, for large enough $\kappa$, the exponent $\frac{nqL + 1}{2^{\kappa/2}}$
%   falls within the range $0 < \frac{nqL + 1}{2^{\kappa/2}} < 1$,
%   so the lemma is applicable.
%   \Qed
% \end{proof}

\begin{theorem}[Typicality]\label{thm:typicality}
  An execution of duration $L$ of \poem is $(\epsilon, \lambda)$-typical with
  probability $1 - e^{-\Omega(\lambda - \log L)} - e^{-\Omega(\kappa - \log L)}$,
  % TODO: The correct probability is $1 - e^{-\Omega(\epsilon^2 \lambda f - \log L)} - e^{-\Omega(\kappa - \log L)}$
  namely, overwhelming in $\lambda$ and $\kappa$.
\end{theorem}
\begin{proof}
  For each $S$ with $|S| = \lambda$,
  \begin{align*}
    \Pr[X(S) < (1 - \epsilon)\E[\underbar{X}(S)]] &\leq\\
    \Pr[\underbar{X}(S) < (1 - \epsilon)\E[\underbar{X}(S)]] &\leq
    e^{-\Omega(\lambda)} \,.\\
    \Pr[X(S) > (1 + \epsilon)\E[\overline{X}(S)]] &\leq\\
    \Pr[\overline{X}(S) > (1 + \epsilon)\E[\overline{X}(S)]] &\leq
    e^{-\Omega(\lambda)} \,.\\
    \Pr[Y(S) < (1 - \epsilon)\E[Y(S)]] \leq e^{-\Omega(\lambda)} &\,.\\
    \Pr[Z(S) > (1 + \epsilon)\E[Z(S)]] \leq e^{-\Omega(\lambda)} &\,.\\
  \end{align*}
  The $e^{-\Omega(\lambda)}$ bounds are obtained by applying
  Theorem~\ref{thm:bern-exp} to each of the random variables
  $\underbar{X}(S), \overline{X}(S), Y(S)$ and $Z(S)$, each
  of which is the sum of $\Theta(\lambda)$ i.i.d. random variables\
  distributed according to $\Bern(p) \times \Exp(\ln2)$ for
  some respective $p \in (0, 1)$.
  Applying a union bound for all $S$ (of which there are $L - \lambda + 1$),
  we obtain that typicality Eq.~\ref{eq.typical-x}, Eq.~\ref{eq.typical-y}
  and Eq.~\ref{eq.typical-z}
  hold with probability $1 - e^{-\Omega(\lambda)+\ln L}$.
  If typicality points~\ref{item:typicality-x-y} and~\ref{item:typicality-z}
  hold for all $S$ with $|S| = \lambda$, then they hold for all $S$ with
  $|S| \geq \lambda$.

  The probability bound for causality follows from the stochastic nature
  of the Random Oracle and is proven in~\cite{backbone}.

  Lastly, Hash Separation follows from Lemma~\ref{lem:hash-separation}.
  \Qed
\end{proof}

% \begin{theorem}[Concentration of Gamma]
%   Consider a family $\{ X_i \}_{i \in [n]}$ of i.i.d. random variables $X_i$ distributed as $\Exp(\lambda)$, $\lambda > 0$,
%   and let $X = \sum_{i = 1}^{n}{X_i}$. Then, for any $0 < \epsilon < 1$, it holds that
%   $\Pr[X > (1 + \epsilon) \E[X]] < e^{-n(\epsilon - \ln(1 + \epsilon))}$,
%   which is negligible in $n$.
% \end{theorem}
% \begin{proof}
% %  First, we calculate the expectation:
% %
% %  \[
% %    \E[X] = \E[\sum_{i = 1}^n X_i] = \sum_{i = 1}^n \E[X_i] = n \E[X_i] = \frac{n}{\lambda}
% %  \]
% %
% %  Next, we calculate the moment generating function:
% %
% %  \[
% %    \E[e^{tX}] = \E[e^{t \sum_{i = 1}^n} X_i] = \E[\prod_{i = 1}^n e^{t X_i}] = \prod_{i = 1}^n \E[e^{t X_i}]
% %    = \E[e^{t X_i}]^n = (\frac{\lambda}{\lambda - t})^n
% %  \]
% %
% %  The third equality stems from the mutual independence of the family $\{ X_i \}_{i \in [n]}$,
% %  whereas the last equality stems from the moment generating function of the exponential.
%   $X$ is distributed as $\Gamma(\alpha=n, \beta=\lambda)$. Therefore
%   $\E[X] = \frac{n}{\lambda}$ and the moment generating
%   function is $\E[e^{tX}] = (\frac{\lambda}{\lambda - t})^n = e^{n\ln(\frac{\lambda}{\lambda - t})}$.
%
% % For all $0 < t < \lambda$,
% % \begin{align*}
% %   \Pr[X > \alpha] = \Pr[e^{tX} > e^{t\alpha}] \leq \frac{\E[e^{tX}]}{e^{t\alpha}}\,.
% % \end{align*}
%
% %  The first equality is by the fact that the exponential function is increasing,
% %  whereas the second inequality is Markov's inequality.
%   \begin{align*}
%     \Pr[X > (1 + \epsilon)\E[X]] = \Pr[X > (1 + \epsilon)\frac{n}{\lambda}] \leq \E[e^{tX}] e^{-t(1 + \epsilon)\frac{n}{\lambda}}\\
%     = e^{n\ln(\frac{\lambda}{\lambda - t}) - t(1 + \epsilon)\frac{n}{\lambda}}\,.
%   \end{align*}
%
%   The first inequality is by the generic Chernoff bound.
%   To minimize the exponent over $t$, we differentiate it and equate to $0$:
%
%   \begin{align*}
%     \frac{d}{dt}(\ln(\frac{\lambda}{\lambda - t}) - t(1 + \epsilon)\frac{1}{\lambda}) &= 0\\
%     \frac{d}{dt}{\ln\lambda - \ln(\lambda - t) - t(1 + \epsilon)\frac{1}{\lambda}} &= 0\\
%     \frac{1}{\lambda - t} - (1 + \epsilon)\frac{1}{\lambda} &= 0\\
%     \frac{1}{\lambda - t} &= (1 + \epsilon)\frac{1}{\lambda}\\
%     \lambda - t &= \frac{\lambda}{1 + \epsilon}\\
%     t &= \lambda(1 - \frac{1}{1 + \epsilon}) = \frac{\lambda \epsilon}{1 + \epsilon}\,.
%   \end{align*}
%
%   We substitute $t$ in the exponent:
%
%   \begin{align*}
%     n \ln(\frac{\lambda}{\lambda - t}) - t(1 + \epsilon)\frac{n}{\lambda} = \\
%     n \ln(\frac{\lambda}{\lambda - \frac{\lambda\epsilon}{1 + \epsilon}}) - \frac{\lambda \epsilon}{1 + \epsilon}(1 + \epsilon)\frac{n}{\lambda} = \\
%     n \ln(\frac{1}{1 - \frac{\epsilon}{1 + \epsilon}}) - \epsilon n = \\
%     n \ln(\frac{1}{\frac{1 + \epsilon - \epsilon}{1 + \epsilon}}) - \epsilon n = \\
%     n \ln(1 + \epsilon) - \epsilon n = \\
%     -n (\epsilon - \ln(1 + \epsilon))\\
%   \end{align*}
%
%   The exponent is negative because
%   \begin{align*}
%     \epsilon - \ln(1 + \epsilon) > 0 \Leftrightarrow \\
%     \epsilon > \ln(1 + \epsilon)\\
%     e^{\epsilon} > 1 + \epsilon\,,
%   \end{align*}
%   which holds because $\epsilon > 0$.
% \end{proof}


\begin{definition}[Block Work Interval]
  A block $B$ of chain $C$ has \emph{work interval}
  $I(B) = \{\xi \geq 0: [\xi] \lhd C = B\}$.
\end{definition}

\begin{lemma}[Entropic Pairing Lemma] \label{lem:pairing}
  Consider a typical execution of PoEM.
  Suppose a block $B$ of a chain $C$ with work interval $I(B)$
  was computed by an honest party in a convergence opportunity.
  For every $\xi \in I(B)$ and every chain $C'$ of the execution,
  block $B' = [\xi] \lhd C'$ is either $B$ or adversarial,
  as long as $B' \neq \bot$.
\end{lemma}
\begin{proof}
  Consider an execution as in the statement and suppose, towards a contradiction,
  that block $B'$ is not $B$ and is honestly computed.
  Since $B$ was computed in a convergence opportunity, $B$ and $B'$
  cannot have been computed in the same round. Let $r$ be the earliest round
  on which $B$ or $B'$ was computed, and $C$ be the chain whose tip this block is.
  Since it was computed by
  an honest party, at round $r + 1$, every other honest party receives
  a chain with work greater or equal to $\xi$.

  \textbf{Claim: } Every block computed after round $r$ will be extending a
  chain with work at least $\xi$. To see this, consider a chain $C^*$ that an honest
  party is extending after $r$. Since the party has adopted $C^*$, by the heaviest
  chain rule, $\awork(C^*) \geq \awork(C)$. By Hash Separation, $\work(C^*) \geq \work(C) \geq \xi$.

  If $B$ is computed after round $r$, it holds that $\xi \not \in I$ (noting that $\work(B) > 0$).
  If $B'$ is computed after round $r$, it holds that $B' \neq [\xi] \lhd C'$.
  Both lead to a contradiction. \Qed
\end{proof}

% The following conjecture is likely true and will allow us to tighten the analysis:
%
% \begin{conjecture}[Entropic Pairing Conjecture]
%   Consider any block $B$ of chain $C$ with work interval $I(B)$
%   computed by an honest party during a round $r$ such that
%   for every $B'$ which was honestly computed during round $r$,
%   it holds that $\work(B) \geq \work(B')$.
%   Then, for every $\xi \in I(B) \setminus I(B')$ and every chain $C'$ of the execution,
%   block $B' = [\xi] \lhd C'$ is either $B$ or adversarial,
%   as long as $B' \neq \bot$.
% \end{conjecture}

\begin{lemma}[Entropic Chain Growth Lemma]
  Suppose that at round $r_1$ an honest party has a chain of work $w$.
  Then, by round $r_2 \geq r_1$, every honest party adopts a chain of work at least
  $w + \sum_{r = r_1}^{r_2 - 1}{X_r}$.
\end{lemma}
\begin{proof}
  By induction on $r_2$. For the inductive base ($r_2 = r_1$), observe that
  if at round $r_1$ an honest party has a chain $C$ of work $w$, then
  that party broadcasted $C$ at the end or round $r_1 - 1$. It follows that
  every honest party receives $C$ at round $r_1$ and adopts a chain with
  greater or equal work.

  For the inductive step, note that by the inductive hypothesis,
  every honest party has received a chain of work at least $w' = w + \sum_{r = r_1}^{r_2 - 2}{X_r}$
  by round $r_2 - 1$. When $X_{r_2 - 1} = 0$ the statement follows directly, so assume
  $X_{r_2 - 1} > 0$. Observe that an honest party successfully queried the random oracle
  with a chain of work at least $w' + X_{r_2 - 1}$ and broadcasted it to the network.
  At round $r_2$, every honest party receives the chain and adopts a chain
  of work at least $w' + X_{r_2 - 1} = w + \sum_{r = r_1}^{r_2 - 1}{X_r}$. \Qed
\end{proof}

\begin{lemma}[Typical Bounds] \label{lem:typical-bounds}
  In typical PoEM executions, for any set $S$ of at least $\lambda$ consecutive rounds,
  it holds that $Y(S) > Z(S)$.
\end{lemma}
\begin{proof}
  \begin{align*}
    Y(S) &> (1 - \epsilon)\E[Y(S)]\\
         &> (1 - \epsilon) f (1 - f) \frac{|S|}{\ln2}
          > \left(1 - \frac{\delta}{3}\right) f \frac{|S|}{\ln2}
          > \left(1 - \frac{2\delta}{3}\right) f \frac{|S|}{\ln2}\\
         &> (1 + \epsilon)\E[Z(S)] \geq Z(S)\,.
  \end{align*}

  The first inequality follows from typical Eq.~\ref{eq.typical-y},
  the second from the bound in Eq.~\ref{eq.ex-y-bound},
  the third from setting $\epsilon = f = \frac{\delta}{6}$
  according to the derivation in~\cite[Chapter 13]{blockchain-foundations},
  the penultimate from the bound in Eq.~\ref{eq.ex-z-bound},
  and the last one from typical Eq.~\ref{eq.typical-z}.
  \Qed
\end{proof}

\atnote{Define Chained Work}

\begin{theorem}[Entropic Growth] \label{thm:entropic-growth} \atnote{TODO: Prove}
  Typical executions of \poem satisfy the Entropic Growth property
  with $s = \lambda$ and $\tau = (1 - \epsilon)f$.
\end{theorem}

\pagebreak
\begin{lemma}[Entropic Patience] \label{lem:patience}
  In a typical execution, any chained work $k \geq 2 \lambda \frac{f}{1 - f} \frac{1}{\ln2} + 8$ is computed
  in more than $\frac{k - 8}{2 \frac{f}{1 - f} \frac{1}{\ln2}} \geq \lambda$ consecutive rounds.
\end{lemma}
\begin{proof}
  Assume, towards a contradiction, there is a set of consecutive rounds $S'$ in which
  the chained work $k$ was computed and $|S'| < \frac{k - 8}{2 \frac{f}{1 - f} \frac{1}{\ln2}}$.
  It holds that $X(S') + Z(S') \geq k$.
  Then, there is a set $S \supseteq S'$ of consecutive rounds with
  $|S| = \ceil*{\frac{k - 8}{2 \frac{f}{1 - f} \frac{1}{\ln2}}} + 1 < \frac{k - 8}{2 \frac{f}{1 - f} \frac{1}{\ln2}} + 2$
  such that $X(S) + Z(S) \geq X(S') + Z(S') \geq k$. However,
  because $|S| > \lambda$, typicality applies and from Lemma~\ref{lem:typical-bounds} we obtain
  $X(S) < (1 + \epsilon) \E[\overline{X}(S)] \leq (1 + \epsilon) \E[\overline{X}_r] |S| <
  (1 + \epsilon) \frac{f}{1 - f} \frac{|S|}{\ln2}$
  and
  $Z(S) < (1 + \epsilon) \E[Z(S)] \leq (1 + \epsilon) \E[Z_r] |S| <
  (1 + \epsilon) \frac{t}{n - t} \frac{f}{1 - f}\frac{|S|}{\ln2} <
  (1 + \epsilon) (1 - \delta) \frac{f}{1 - f}\frac{|S|}{\ln2}$.
  Hence,
  \begin{align*}
    X(S) + Z(S) < (1 + \epsilon) \frac{f}{1 - f} \frac{|S|}{\ln2} (1 + 1 - \delta) <
    2 \frac{f}{1 - f} \frac{|S|}{\ln2} <\\
    2\frac{k - 8}{2 \frac{f}{1 - f} \frac{1}{\ln2}} \frac{f}{1 - f} \frac{1}{\ln2} + 4 \frac{f}{1 - f} \frac{1}{\ln2} =\\
    k - 8 + 4 \frac{f}{1 - f} \frac{1}{\ln2} = k - 4 \left(2 - \frac{f}{1 - f} \frac{1}{\ln2}\right) < k\,.
  \end{align*}
  The last inequality follows from $2 - \frac{f}{1 - f} \frac{1}{\ln2} < 0$.
  \Qed
\end{proof}

\begin{corollary} \label{cor:slicing-work-bound}
  In a typical execution of \poem, for any honest party $P$ and any round $r$ it holds that
  $\work([{:}{-k}] \lhd \Chain[P][][r]) < 2k$.
\end{corollary}
\begin{proof}
  From Entropic Patience (Lemma~\ref{lem:patience}), every block has less than $k$ work. Therefore,
  $\work([-k] \lhd \Chain[P][][r]) < k$.
  From the definition of the slicing notation ($[{:}]\lhd$)
  it holds that $\work(([-k{:}] \lhd \Chain[P][][r])[1{:}]) \leq k$. Summing the two constituents,
  we obtain
  \begin{align*}
    \work([-k{:}] \lhd \Chain[P][][r]) =\\
    \work(([-k{:}] \lhd \Chain[P][][r])[1{:}]) + \work([-k] \lhd \Chain[P][][r]) < 2k\,.
  \end{align*}
  \Qed
\end{proof}

\begin{lemma}[Entropic Common Prefix Lemma]
  Suppose at round $r$ of a PoEM typical execution an honest party has a chain
  $C_1$, while a chain $C_2$ of work at least $\work(C_1)$ is adopted by an honest party.
  Then, $[{:}{-k}] \lhd C_1 \preccurlyeq C_2$ and $[{:}{-k}] \lhd C_2 \preccurlyeq C_1$
  for $k = 2 \lambda f$.
\end{lemma}
\begin{proof}
    Consider an execution as in the statement and suppose,
    towards a contradiction, that $[{:}{-k}] \lhd C_1 \not \preccurlyeq C_2$
    or $[{:}{-k}] \lhd C_2 \not \preccurlyeq C_1$.
    Consider the last block $B^*$ with index $i^*$ on the common prefix of
    $C_1$ and $C_2$ that was computed by an honest party and let $r^*$
    be the round at which it was computed; if no such block exists let $r^* = 0$.
    Define the set of rounds $S = \{i: r^* < i < r\}$. We claim that
    $Z(S) \geq Y(S)$.

    We show this by pairing all work of blocks computed by honest parties during
    convergence opportunities in $S$ with adversarial work computed during $S$.
    Let $\mathcal{Y}(S)$ be the set of honestly produced blocks in convergence opportunities
    during $S$, and $\Xi = \bigcup \{I(B): B \in \mathcal{Y}(S)\}$.

    Note that, if $\Xi \neq \emptyset$, then $\min{\Xi} > \max{I(B^*)}$
    because the chain ending in block $B^*$
    was diffused at round $r^*$, and all honestly produced blocks after round $r^*$
    are extending a chain with greater or equal work.
    Also note that $\work(C_1) \geq \max{\Xi}$ and $\work(C_2) \geq \max{\Xi}$ because
    the honest party that computed the chain with work $\max \Xi$ diffused it and any chain adopted
    by honest parties at any later round should have at least $\max \Xi$ work.
    Hence, for every $\xi \in \Xi$ it holds that
    $[\xi] \lhd C_1 \neq \bot$ and $[\xi] \lhd C_2 \neq \bot$.

    We now argue that for every $\xi \in \Xi$ either block $[\xi] \lhd C_1$
    or block $[\xi] \lhd C_2$ is adversarial. If the block lies on the
    common prefix of $C_1$ and $C_2$ ($[\xi] \lhd C_1 = [\xi] \lhd C_2$),
    then it is adversarial by the definition of $B^*$. Otherwise,
    there is one block in $C_1$ and another one in $C_2$, and by
    Lemma~\ref{lem:pairing}, it holds that $[\xi] \lhd C_1$ and
    $[\xi] \lhd C_2$ cannot both be honest.
    This completes the proof of the claim $Z(S) \geq Y(S)$.

    It holds that all chained work $\work(C_2[{i^*} {:}]) \geq k$
    was produced during $S$.
    Hence, from Lemma~\ref{lem:patience}, $|S| > \lambda$ and
    the properties of a typical execution apply.
    Therefore, by Lemma~\ref{lem:typical-bounds},
    $Z(S) < Y(S)$ which contradicts the previous claim. \Qed
\end{proof}

\begin{theorem}[Entropic Common Prefix] \label{thm:common-prefix} \atnote{TODO: Prove}
  Typical executions of \poem satisfy the Entropic Common Prefix property
  with $k = 2 \lambda f$.
\end{theorem}

\begin{theorem}[Entropic Quality] \label{thm:entoropic-quality} \atnote{TODO: Prove}
  Typical executions of \poem satisfy the Entropic Quality property
  with $\ell = 2 \lambda f$ and
  $\mu = 1 - (1 + \frac{\delta}{2})\frac{t}{n - t} - \frac{\epsilon}{1 - \epsilon}$.
\end{theorem}

\begin{conjecture}[\poem is Safe]
  Typical executions of \poem are safe.
\end{conjecture}
\begin{proof}
  Consider any two honest parties $P_1, P_2$ and
  any rounds $r_1, r_2$. Let $C_1, C_2$ be the chains that $P_1, P_2$
  adopt at rounds $r_1, r_2$ respectively.
  From Entropic Common Prefix (Theorem~\ref{thm:common-prefix}), it follows that:
  \begin{itemize}
    \item if $r_1 \leq r_2$, then $[{:}{-k}] \lhd C_1 \preceq C_2$.
    \item if $r_2 \leq r_1$, then $[{:}{-k}] \lhd C_2 \preceq C_1$.
  \end{itemize}
  In both cases, it follows that $[{:}{-k}] \lhd C_1 \sim [{:}{-k}] \lhd C_2$.
  Therefore, for the ledgers $\Ledger[P_1][][r_1], \Ledger[P_2][][r_2]$ returned when
  \lread is invoked on parties $P_1, P_2$ after rounds $r_1, r_2$ respectively,
  it holds that $\Ledger[P_1][][r_1] \sim \Ledger[P_2][][r_2]$.
\end{proof}

\begin{conjecture}[\poem is Live]
  Typical executions of \poem are live with parameter $u = \max(\ceil*{\frac{\ell + 2k}{(1 - \epsilon) f} \ln2}, s)$.
\end{conjecture}
\begin{proof}
  % $k = \frac{2 \lambda f}{\ln2}$
  % $\ell = \frac{2 \lambda f}{\ln2}$
  Consider any round $r$.
  Because $u \geq s$, invoking Entropic Growth($s, \tau$) (Theorem~\ref{thm:entropic-growth}), we conclude that
  for all honest parties $P$ and all rounds $r' \geq r + u$, it holds that
  $\work(\Chain[P][][r'][|\Chain[P][][r]|{:}]) \geq u \tau \geq \ell + 2k$.
  From Corollary~\ref{cor:slicing-work-bound}, it follows that
  $\work([{:}{-k}] \lhd \Chain[P][][r'][|\Chain[P][][r]|{:}]) \geq \ell$.
  Invoking Entropic Quality (Theorem~\ref{thm:entoropic-quality}),
  it holds that in the chain segment $[{:}{-k}] \lhd \Chain[P][][r'][|\Chain[P][][r]|{:}]$,
  there is at least one honestly generated block that was produced after round $r$.

  Now, consider that an honest party attempts to inject a transaction \tx
  at round $r$. At the beginning of round $r + 1$, all honest parties
  receive \tx and include it in their mempool~\cite[Section 5.7]{blockchain-foundations}.
  Hence, all honest blocks produced
  after round $r$ will either include, or extend a chain that includes transaction \tx.
  Because of this and the above, for all honest parties $P$ and rounds $r' \geq r + u$,
  we conclude that $\tx \in \Ledger[P][][r']$.
  \Qed
\end{proof}

\begin{corollary}[\poem is Secure]
  Typical executions of \poem are secure.
\end{corollary}
\begin{proof}
  Security follows from safety and liveness.
  \Qed
\end{proof}
